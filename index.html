<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet-search.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ================================================= */
        /* --- 1. CORRECCIONES DE ICONOS (VECTORES SVG) --- */
        /* ================================================= */
        .borrar-estilo {
            background: transparent !important;
            border: none !important;
        }
        .borrar-estilo i {
            width: 100%;
            height: 100%;
            display: block;
            line-height: 24px; /* Centra el icono verticalmente */
        }

        /* ========================================= */
        /* --- 2. ESTRUCTURA BASE Y LAYOUT MAPA --- */
        /* ========================================= */
        * { box-sizing: border-box; }
        
        html, body { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            display: flex; flex-direction: column;  
        }

        #top-bar {
            flex: 0 0 70px; 
            background: #7E1928; 
            border-bottom: 4px solid #C3935D; 
            color: white;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 3000; position: relative;
        }

        #map {
            flex: 1; width: 100%; height: auto !important; 
            margin: 0; background-color: #f0f0f0; z-index: 1;
        }

        /* --- LOGOS Y TITULOS --- */
        .logo-area { display: flex; align-items: center; height: 100%; }
        
        /* Caja blanca del logo */
        .logo-box {
            background-color: white; padding: 5px 12px;
            border-radius: 6px; margin-right: 15px;
            height: 60px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        #drobot-logo { 
            height: 90%; width: auto; 
            display: block; filter: none;
        }

        .drobot-title { 
            font-weight: 700; font-size: 18px; letter-spacing: 0.5px;
            line-height: 1.2; text-transform: uppercase;
        }

        .client-area { 
            font-size: 13px; color: rgba(255,255,255,0.9); 
            border-left: 1px solid #C3935D; padding-left: 20px; 
            font-weight: 600; height: 40px; display: flex; align-items: center;
        }

        /* ========================================= */
        /* --- 3. CONTROLES Y MENÚ DE CAPAS --- */
        /* ========================================= */
        .leaflet-bar {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            border: none !important; border-radius: 8px !important; overflow: hidden;
        }
        .leaflet-bar a, .leaflet-control-layers-toggle {
            background-color: white !important; color: #444 !important;
            width: 36px !important; height: 36px !important; line-height: 36px !important;
            font-weight: bold !important; border-bottom: 1px solid #f0f0f0 !important;
            transition: all 0.2s ease;
        }
        .leaflet-bar a:hover {
            background-color: #f8f9fa !important; color: #A21131 !important; 
            border-left: 3px solid #C3935D !important;
        }

        /* Menú de Capas Desplegado */
        .leaflet-control-layers {
            border: none !important; border-radius: 12px !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15) !important;
            padding: 15px !important;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(5px);
        }
        .leaflet-control-layers-group-label {
            color: #7E1928; font-weight: 700; font-size: 14px;
            margin-top: 8px; display: block; border-bottom: 2px solid #C3935D; 
            padding-bottom: 4px; margin-bottom: 8px;
        }
        .leaflet-control-layers label {
            margin-bottom: 6px; font-size: 13px; cursor: pointer; transition: color 0.2s;
        }
        .leaflet-control-layers label:hover { color: #A21131; }

        /* ========================================= */
        /* --- 4. POPUPS (TARJETAS) --- */
        /* ========================================= */
        .leaflet-popup-content-wrapper {
            border-radius: 16px !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2) !important;
            padding: 0 !important; overflow: hidden;
        }
        .leaflet-popup-content {
            margin: 0 !important; line-height: 1.6; font-size: 13px;
            min-width: 300px !important;
        }
        
        /* Utilidades para Agebs y Manzanas */
        .leaflet-tooltip.label-ageb {
            background: transparent; border: none; box-shadow: none;
        }
        .leaflet-popup-content table tr:first-child { display: none !important; }

        /* ========================================= */
        /* --- 5. VISOR DE FOTOS (MODAL SIMPLE) --- */
        /* ========================================= */
        #image-modal.modal-overlay {
            /* Este ID específico se usa para las fotos, usa lógica simple */
            z-index: 100000;
        }
        .modal-content {
            margin: auto; display: block; width: auto; height: auto;
            max-width: 90vw; max-height: 85vh;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: zoom 0.4s;
        }
        @keyframes zoom { from {transform:scale(0.8); opacity:0} to {transform:scale(1); opacity:1} }
        .close-modal {
            position: absolute; top: 20px; right: 35px; color: #f1f1f1;
            font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer;
        }

        /* ================================================== */
        /* --- 6. DASHBOARD CORREGIDO (CENTRO Y ANIMACIÓN) --- */
        /* ================================================== */
        
        /* Fondo Oscuro con Centrado Flexbox */
        .modal-overlay {
            display: none; /* JS lo activa con 'flex' */
            position: fixed; z-index: 99999;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(4px);
            
            /* ESTO CENTRA LA TARJETA PERFECTAMENTE */
            align-items: center;
            justify-content: center;
        }

        /* La Tarjeta del Gráfico */
        .chart-card-drobot {
            background: white;
            border-radius: 16px;
            width: 90%; max-width: 700px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex; flex-direction: column;
            
            /* ANIMACIÓN SUAVE */
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) both;
        }

        @keyframes slideUp { 
            0% { transform: translateY(100px) scale(0.9); opacity: 0; } 
            100% { transform: translateY(0) scale(1); opacity: 1; } 
        }

        /* Partes internas del Dashboard */
        .chart-header-drobot {
            background: #7E1928 !important; border-bottom: 3px solid #C3935D !important;
            color: white; padding: 15px 25px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .chart-title { font-weight: 700; font-size: 18px; letter-spacing: 0.5px; }
        .close-chart-btn { font-size: 28px; cursor: pointer; color: rgba(255,255,255,0.8); }
        .chart-body-drobot { padding: 25px; height: 350px; position: relative; }
        .chart-controls-drobot {
            padding: 15px 25px; background: #f8f9fa; border-top: 1px solid #eee;
            display: flex; justify-content: center; gap: 10px;
        }
        .chart-btn {
            background: white; border: 1px solid #ddd; padding: 10px 20px;
            border-radius: 30px; cursor: pointer; color: #555;
            transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;
        }
        .chart-btn.active {
            background: #7E1928; color: white; border-color: #7E1928;
            box-shadow: 0 4px 10px rgba(126, 25, 40, 0.3);
        }

        /* Pestañas (Tabs) */
        .chart-tabs {
            display: flex; background: #f1f2f6; padding: 5px; gap: 5px; border-bottom: 1px solid #ddd;
        }
        .tab-btn {
            flex: 1; border: none; background: transparent; padding: 10px;
            cursor: pointer; font-family: 'Montserrat', sans-serif; font-weight: 600;
            color: #7f8c8d; border-radius: 8px; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .tab-btn:hover { background: rgba(0,0,0,0.05); color: #2c3e50; }
        .tab-btn.active {
            background: white; color: #922B21; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ========================================= */
        /* --- 7. SLIDER GOOGLE EARTH (OCULTO) --- */
        /* ========================================= */
        .btn-google-earth {
            display: none !important; /* <--- OCULTO POR INSTRUCCIÓN DEL JEFE */
            background-color: #333 !important; 
            border-radius: 50% !important;
            width: 40px !important; height: 40px !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5) !important;
            cursor: pointer; align-items: center; justify-content: center;
            border: 2px solid rgba(255,255,255,0.3) !important;
            transition: transform 0.2s, background-color 0.2s; z-index: 9999 !important;
        }
        .leaflet-sbs-divider, .leaflet-sbs-range, .sbs-handle-visual, .year-chip {
            display: none !important; /* Ocultamos también los accesorios del slider */
        }

        /* ========================================= */
        /* --- 8. RESPONSIVIDAD (MÓVIL) --- */
        /* ========================================= */
        .panel-movil-oculto {
            display: none; position: fixed; bottom: -100%; left: 0; width: 100%;
            background: white; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3); z-index: 99999;
            transition: bottom 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            padding: 20px; max-height: 50vh; overflow-y: auto;
        }
        .panel-movil-activo { bottom: 0 !important; display: block; }
        
        #btn-cerrar-panel {
            position: absolute; top: 10px; right: 15px;
            background: #7E1928; color: white; border: none; border-radius: 50%;
            width: 30px; height: 30px; font-size: 20px; cursor: pointer; z-index: 100000;
        }

        @media (max-width: 768px) {
            #top-bar { flex: 0 0 60px; padding: 0 10px; } 
            .logo-area img { height: 35px; }
            .drobot-title { font-size: 14px; line-height: 1.1; }
            .client-area { display: none; } 
            .leaflet-popup { display: none !important; }
            
            /* Botones abajo a la derecha */
            .leaflet-top.leaflet-left {
                top: auto !important; left: auto !important;
                bottom: 30px !important; right: 15px !important;   
                display: flex; flex-direction: column-reverse; align-items: flex-end;
            }
            .leaflet-control { margin-bottom: 15px !important; margin-right: 0 !important; border: none !important; box-shadow: 0 4px 10px rgba(0,0,0,0.4) !important; }
            .leaflet-control-zoom { border-radius: 20px !important; overflow: hidden; }
            .leaflet-control-zoom a { width: 45px !important; height: 45px !important; line-height: 45px !important; font-size: 20px !important; color: #333 !important; }
            .leaflet-control-layers-toggle {
                width: 50px !important; height: 50px !important; border-radius: 50% !important;
                background-color: #7E1928 !important; background-size: 24px !important;
                filter: invert(1) brightness(2); 
            }
            .leaflet-control-scale { display: none; }
        }
    </style>
    <title>Catastro Municipal</title>
</head>

<body>
    <div id="top-bar"> 
        <div class="logo-area">
            <div class="logo-box">
                <img src="logo_poza.png" alt="Escudo" id="drobot-logo">
            </div>
            <div style="display:flex; flex-direction:column; justify-content:center;">
                <span class="drobot-title" style="font-size:16px;">H. AYUNTAMIENTO</span>
                <span style="font-size:11px; font-weight:400; text-transform:uppercase; letter-spacing:1px;">Poza Rica de Hidalgo | 2026-2029</span>
            </div>
        </div>
        <div class="client-area">
            <span>CATASTRO Y DESARROLLO URBANO</span>
        </div>
    </div> 
    
    <div id="map"></div>
    <script src="data/RiesgoAlto_15.js"></script>
    <script src="data/RiesgoMedio_14.js"></script>
    <script src="data/RiesgoBajo_13.js"></script>
    <script src="data/AGEB_6.js"></script>
    <script src="data/Vialidades_7.js"></script>
    <script src="data/Manzanas_4.js"></script>
    <script src="data/Limitemunicipal_5.js"></script>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet.photon.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="js/leaflet-search.js"></script>
    <script src="data/Otro_6.js"></script>
    <script src="data/Intermitente_7.js"></script>
    <script src="data/Directa_8.js"></script>
    <script src="data/Daado_9.js"></script>
    <script src="data/Bueno_10.js"></script>
    <script src="data/Apagada_11.js"></script>
    <script src="data/Alumbradopostes_12.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/digidem/leaflet-side-by-side@2.0.0/leaflet-side-by-side.min.js"></script>
    
    <script>
    var highlightLayer;
    function highlightFeature(e) {
        highlightLayer = e.target;
        if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
            highlightLayer.setStyle({ color: '#ffff00' });
        } else {
            highlightLayer.setStyle({ fillColor: '#ffff00', fillOpacity: 1 });
        }
    }

    var map = L.map('map', {
        zoomControl:false, maxZoom:28, minZoom:1
    }).setView([20.5333, -97.4500], 13); 

    var dibujanteCompartido = L.canvas({ padding: 0.5 , tolerance: 15});
    map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
    
    var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

    function removeEmptyRowsFromPopupContent(content, feature) {
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        var rows = tempDiv.querySelectorAll('tr');
        for (var i = 0; i < rows.length; i++) {
            var td = rows[i].querySelector('td.visible-with-data');
            var key = td ? td.id : '';
            if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                rows[i].parentNode.removeChild(rows[i]);
            }
        }
        return tempDiv.innerHTML;
    }

    function addClassToPopupIfMedia(content, popup) {
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        var imgTd = tempDiv.querySelector('td img');
        if (imgTd) {
            var src = imgTd.getAttribute('src');
            if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                popup._contentNode.classList.add('media');
                setTimeout(function() { popup.update(); }, 10);
            } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                // Audio logic
                var audio = document.createElement('audio'); audio.controls = true; audio.src = src;
                imgTd.parentNode.replaceChild(audio, imgTd);
                popup._contentNode.classList.add('media');
                setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
            } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                // Video logic
                var video = document.createElement('video'); video.controls = true; video.src = src;
                video.style.width = "400px"; video.style.height = "300px"; video.style.maxHeight = "60vh"; video.style.maxWidth = "60vw";
                imgTd.parentNode.replaceChild(video, imgTd);
                popup._contentNode.classList.add('media');
                video.addEventListener('loadedmetadata', function() { popup.update(); });
                setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
            } else {
                popup._contentNode.classList.remove('media');
            }
        } else {
            popup._contentNode.classList.remove('media');
        }
    }

    var zoomControl = L.control.zoom({ position: 'topleft' }).addTo(map);
    var measureControl = new L.Control.Measure({
        position: 'topleft',
        primaryLengthUnit: 'meters', secondaryLengthUnit: 'kilometers',
        primaryAreaUnit: 'sqmeters', secondaryAreaUnit: 'hectares'
    });
    measureControl.addTo(map);
    document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
    document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
    
    var bounds_group = new L.featureGroup([]);

    map.createPane('pane_PuntosAltos');
    map.getPane('pane_PuntosAltos').style.zIndex = 650;

    // --- CAPAS BASE ---
    map.createPane('pane_OpenStreetMap_0'); map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
    var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { pane: 'pane_OpenStreetMap_0', opacity: 1.0, minZoom: 1, maxZoom: 28 });

    map.createPane('pane_GoogleMaps_1'); map.getPane('pane_GoogleMaps_1').style.zIndex = 401;
    var layer_GoogleMaps_1 = L.tileLayer('https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}', { pane: 'pane_GoogleMaps_1', opacity: 1.0, minZoom: 1, maxZoom: 28 });

    map.createPane('pane_GoogleMapSatellite_2'); map.getPane('pane_GoogleMapSatellite_2').style.zIndex = 402;
    var layer_GoogleMapSatellite_2 = L.tileLayer('http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}', { pane: 'pane_GoogleMapSatellite_2', opacity: 1.0, minZoom: 1, maxZoom: 28 });
    map.addLayer(layer_GoogleMapSatellite_2);

    map.createPane('pane_GoogleSatelliteHybrid_3'); map.getPane('pane_GoogleSatelliteHybrid_3').style.zIndex = 403;
    var layer_GoogleSatelliteHybrid_3 = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', { pane: 'pane_GoogleSatelliteHybrid_3', opacity: 1.0, minZoom: 1, maxZoom: 28 });

    // --- ORTOFOTOS ---
    map.createPane('pane_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4'); map.getPane('pane_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4').style.zIndex = 404;
    var layer_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4 = new L.imageOverlay('data/dji_fly_20250722_185244_0181_1769184310403_photo_modified_4.webp', [[20.477305525524667,-97.44742707624859],[20.477688255136947,-97.44690449256086]], {pane: 'pane_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4'});
    bounds_group.addLayer(layer_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4);
    map.addLayer(layer_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4);

    map.createPane('pane_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5'); map.getPane('pane_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5').style.zIndex = 405;
    var layer_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5 = new L.imageOverlay('data/dji_fly_20250722_185256_0182_1769184314666_photo_modified_5.webp', [[20.47713020129182,-97.44748035804977],[20.47751380984635,-97.44692639028311]], {pane: 'pane_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5'});
    bounds_group.addLayer(layer_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5);
    map.addLayer(layer_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5);

    // ==============================================================
    // --- BLOQUE MAESTRO LIMPIO: TARJETAS, LUMINARIAS Y BACHES ---
    // ==============================================================

    // --- 1. CONFIGURACIÓN VISUAL ---
    const COLOR_SUBTITLE = '#546e7a';
    const COLOR_TEXT = '#2c3e50';
    var placeholderFoto = `
        <div style="background: #f8f9fa; border: 2px dashed #cfd8dc; border-radius: 8px; padding: 25px 0; text-align: center;">
            <i class="fas fa-camera-retro" style="font-size: 28px; color: #b0bec5; margin-bottom: 8px;"></i>
            <div style="font-size: 11px; font-weight: 600; color: #90a4ae; text-transform: uppercase; letter-spacing: 0.5px;">Sin Evidencia Fotográfica</div>
        </div>`;

    // --- 2. FUNCIÓN DE TARJETA PROFESIONAL (V8) ---
    function generarTarjetaProfesional(props, fotoHtml, tituloCategoria, iconoClase, colorCabecera) {
        var obs = props['Observaciones'];
        var obsHtml = (obs && obs !== "" && obs.toLowerCase() !== "ninguno")
            ? obs : '<span style="color:#aaa;">Sin observaciones registradas.</span>';

        return `
        <div style="font-family: 'Montserrat', sans-serif; min-width: 300px; overflow: hidden;">
            <div style="background: ${colorCabecera}; color: white; padding: 12px 18px; border-radius: 12px 12px 0 0; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <span style="font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center;">
                    <i class="${iconoClase}" style="margin-right: 10px; font-size: 16px; color: rgba(255,255,255,0.9);"></i> ${tituloCategoria}
                </span>
                <span style="background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 700; letter-spacing: 0.5px; border: 1px solid rgba(255,255,255,0.2);">
                    ${props['Id'] || 'S/N'}
                </span>
            </div>
            <div style="padding: 18px; background: white; border: 1px solid #eee; border-top: none; border-radius: 0 0 12px 12px;">
                <table style="width: 100%; border-collapse: separate; border-spacing: 0 12px;">
                    <tr style="display:none;"><td></td></tr>
                    <tr>
                        <th style="text-align:left; color:${COLOR_SUBTITLE}; font-size:10px; text-transform:uppercase; letter-spacing:0.5px; width: 35%;">Tipo</th>
                        <td style="color:${COLOR_TEXT}; font-size:15px; font-weight: 700;">${props['Tipo'] || 'No especificado'}</td>
                    </tr>
                    <tr>
                        <th style="text-align:left; color:${COLOR_SUBTITLE}; font-size:10px; text-transform:uppercase; letter-spacing:0.5px;">Estado</th>
                        <td style="color:${COLOR_TEXT}; font-size:15px; font-weight: 700;">${props['Estado'] || 'Desconocido'}</td>
                    </tr>
                    <tr><td colspan="2" style="padding-top: 5px;">${fotoHtml}</td></tr>
                    <tr>
                        <td colspan="2" style="padding-top: 8px;">
                            <div style="background: #f9f9f9; padding: 12px; border-radius: 8px; border-left: 3px solid #ccc; font-size: 12px; color: #555; line-height: 1.4;">
                                <strong style="display:block; font-size:9px; color:${COLOR_SUBTITLE}; text-transform:uppercase; margin-bottom:4px;">Reporte:</strong>
                                ${obsHtml}
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>`;
    }

    // --- 3. GENERADORES DE ICONOS (Vectores SVG) ---
    function crearIconoLuz(color) {
        return L.divIcon({ className: 'borrar-estilo', iconSize: [24, 24], iconAnchor: [12, 12], popupAnchor: [0, -10],
            html: `<div style="width: 24px; height: 24px; filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.3));"><svg viewBox="0 0 100 100" width="24" height="24"><circle cx="50" cy="50" r="40" fill="${color}" stroke="white" stroke-width="12" /></svg></div>`
        });
    }
    function crearIconoBache(color) {
        return L.divIcon({ className: 'borrar-estilo', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -20],
            html: `<div style="font-size: 32px; color: ${color}; filter: drop-shadow(0 0 1px white) drop-shadow(0 0 2px white) drop-shadow(2px 4px 6px rgba(0,0,0,0.6)); text-align:center; display:flex; justify-content:center; margin-top:-10px; margin-left:-5px;"><i class="fa fa-exclamation-triangle"></i></div>`
        });
    }

    // --- 4. CAPAS DE LUMINARIAS (Con colores) ---
    
    // OTRO (#d35400)
    function pop_Otro_6(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#d35400"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Otro_6 = new L.geoJson(json_Otro_6, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Otro_6, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#e67e22') }); } });
    bounds_group.addLayer(layer_Otro_6); map.addLayer(layer_Otro_6);

    // INTERMITENTE (#8e44ad)
    function pop_Intermitente_7(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#8e44ad"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Intermitente_7 = new L.geoJson(json_Intermitente_7, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Intermitente_7, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#9b59b6') }); } });
    bounds_group.addLayer(layer_Intermitente_7); map.addLayer(layer_Intermitente_7);

    // DIRECTA (#f39c12)
    function pop_Directa_8(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#f39c12"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Directa_8 = new L.geoJson(json_Directa_8, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Directa_8, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#f1c40f') }); } });
    bounds_group.addLayer(layer_Directa_8); map.addLayer(layer_Directa_8);

    // DAÑADO (#c0392b)
    function pop_Daado_9(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#c0392b"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Daado_9 = new L.geoJson(json_Daado_9, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Daado_9, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#e74c3c') }); } });
    bounds_group.addLayer(layer_Daado_9); map.addLayer(layer_Daado_9);

    // BUENO (#27ae60)
    function pop_Bueno_10(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#27ae60"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Bueno_10 = new L.geoJson(json_Bueno_10, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Bueno_10, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#2ecc71') }); } });
    bounds_group.addLayer(layer_Bueno_10); map.addLayer(layer_Bueno_10);

    // APAGADA (#2c3e50)
    function pop_Apagada_11(feature, layer) {
        var props = feature.properties;
        var foto = (props['Foto_evidencia']) ? `<img src="images/${props['Foto_evidencia']}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        layer.bindPopup(generarTarjetaProfesional(props, foto, "ALUMBRADO PÚBLICO", "fas fa-lightbulb", "#2c3e50"), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }
    var layer_Apagada_11 = new L.geoJson(json_Apagada_11, { attribution: '', interactive: true, pane: 'pane_PuntosAltos', onEachFeature: pop_Apagada_11, pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoLuz('#34495e') }); } });
    bounds_group.addLayer(layer_Apagada_11); map.addLayer(layer_Apagada_11);

    // --- 5. CAPAS DE BACHES (Con colores) ---
    function pop_BacheGeneral(feature, layer, colorRiesgo) {
        var props = feature.properties;
        var nombreFoto = props['Foto_Evidencia']; 
        if (nombreFoto && nombreFoto.includes('/')) { nombreFoto = nombreFoto.split('/').pop(); }
        var fotoHtml = (nombreFoto) ? `<img src="images/${nombreFoto}" style="width:100%; border-radius:8px; cursor:pointer;" onclick="openImageModal(this.src)">` : placeholderFoto;
        var propsAdaptados = {
            'Id': props['ID_Reporte'], 'Tipo': props['Tamano'], 'Estado': props['Estado_reparacion'], 
            'Observaciones': props['Peligro'] ? `Nivel de Peligro: ${props['Peligro']}` : ''
        };
        layer.bindPopup(generarTarjetaProfesional(propsAdaptados, fotoHtml, "REPORTE DE BACHE", "fas fa-car-crash", colorRiesgo), { maxHeight: 500 });
        layer.on('click', function(e) { map.flyTo(e.latlng, 19); });
    }

    // RIESGO ALTO (#c0392b)
    var layer_RiesgoAlto;
    if (typeof json_RiesgoAlto_15 !== 'undefined') {
        layer_RiesgoAlto = new L.geoJson(json_RiesgoAlto_15, { pane: 'pane_PuntosAltos',
            pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoBache('#ff0000') }); },
            onEachFeature: function(f, l) { pop_BacheGeneral(f, l, '#c0392b'); }
        });
        bounds_group.addLayer(layer_RiesgoAlto); map.addLayer(layer_RiesgoAlto);
    } else { layer_RiesgoAlto = L.layerGroup(); }

    // RIESGO MEDIO (#d35400)
    var layer_RiesgoMedio;
    if (typeof json_RiesgoMedio_14 !== 'undefined') {
        layer_RiesgoMedio = new L.geoJson(json_RiesgoMedio_14, { pane: 'pane_PuntosAltos',
            pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoBache('#ff9f43') }); },
            onEachFeature: function(f, l) { pop_BacheGeneral(f, l, '#d35400'); }
        });
        bounds_group.addLayer(layer_RiesgoMedio); map.addLayer(layer_RiesgoMedio);
    } else { layer_RiesgoMedio = L.layerGroup(); }

    // RIESGO BAJO (#f39c12)
    var layer_RiesgoBajo;
    if (typeof json_RiesgoBajo_13 !== 'undefined') {
        layer_RiesgoBajo = new L.geoJson(json_RiesgoBajo_13, { pane: 'pane_PuntosAltos',
            pointToLayer: function (f, l) { return L.marker(l, { icon: crearIconoBache('#f1c40f') }); },
            onEachFeature: function(f, l) { pop_BacheGeneral(f, l, '#f39c12'); }
        });
        bounds_group.addLayer(layer_RiesgoBajo); map.addLayer(layer_RiesgoBajo);
    } else { layer_RiesgoBajo = L.layerGroup(); }

    function pop_Alumbradopostes_12(feature, layer) { layer.bindPopup(removeEmptyRowsFromPopupContent('<table><tr><td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(String(feature.properties['fid']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Id'] !== null ? autolinker.link(String(feature.properties['Id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Tipo'] !== null ? autolinker.link(String(feature.properties['Tipo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Estado'] !== null ? autolinker.link(String(feature.properties['Estado']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Foto_evidencia'] !== null ? '<img src="images/' + String(feature.properties['Foto_evidencia']).replace(/[\\/:]/g, '_').trim().replace(/'/g, '\'').replace(/"/g, '&quot;') + '">' : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Observaciones'] !== null ? autolinker.link(String(feature.properties['Observaciones']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr><tr><td colspan="2">' + (feature.properties['Cuenta'] !== null ? autolinker.link(String(feature.properties['Cuenta']).replace(/'/g, '\'').toLocaleString()) : '') + '</td></tr></table>', feature), { maxHeight: 400 }); }
    function style_Alumbradopostes_12_0(feature) { return { pane: 'pane_Alumbradopostes_12', icon: L.icon({ iconUrl: 'markers/Alumbradopostes_12.svg', iconSize: [0, 0] }) }; }
    map.createPane('pane_Alumbradopostes_12'); map.getPane('pane_Alumbradopostes_12').style.zIndex = 412;
    var layer_Alumbradopostes_12 = new L.geoJson(json_Alumbradopostes_12, { attribution: '', interactive: false, pane: 'pane_Alumbradopostes_12', onEachFeature: pop_Alumbradopostes_12, pointToLayer: function (feature, latlng) { return L.marker(latlng, style_Alumbradopostes_12_0(feature)); } });
    bounds_group.addLayer(layer_Alumbradopostes_12);

    /* --- 1. CREACIÓN DE CAPAS DE GOBIERNO --- */

    // --- A. LÍMITES MUNICIPALES ---
    map.createPane('pane_Limites');
    map.getPane('pane_Limites').style.zIndex = 600; 
    map.getPane('pane_Limites').style.pointerEvents = 'none';

    var layer_Limites; 
    if (typeof json_Limitemunicipal_5 !== 'undefined') {
        layer_Limites = new L.geoJson(json_Limitemunicipal_5, { 
            style: {
                pane: 'pane_Alumbradopostes_12', 
                color: '#ffff00', // Dorado
                weight: 4,
                dashArray: '15, 5, 1, 5',
                fill: false,
                interactive: false
            }
        }).addTo(map); 
    } else {
        console.log("⚠️ ERROR: Busqué 'json_Limitemunicipal_5' y no lo hallé.");
        layer_Limites = L.layerGroup(); 
    }

    // --- B. MANZANAS ---
    var manzanaActiva = null; 
    var layer_Manzanas;

    if (typeof json_Manzanas_4 !== 'undefined') {
        layer_Manzanas = new L.geoJson(json_Manzanas_4, {
            
            renderer: dibujanteCompartido, 
            smoothFactor: 3,             
            
            style: function(feature) {
                return {
                    pane: 'pane_Alumbradopostes_12',
                    color: '#0066ff',
                    weight: 2.6,  
                    fill: true,
                    fillColor: '#000000', 
                    fillOpacity: 0.1,     
                    interactive: true
                };
            },
            
            onEachFeature: function (feature, layer) {
                var props = feature.properties;
                var fichaHTML = `
                    <div style="font-family: 'Montserrat', sans-serif; min-width: 220px;">
                        <div style="background: #7E1928; color: white; padding: 10px; border-radius: 8px 8px 0 0; border-bottom: 3px solid #C3935D; text-align: center;">
                            <div style="font-size: 10px; letter-spacing: 1px; opacity: 0.8; text-transform:uppercase;">Manzana Catastral</div>
                            <div style="font-size: 16px; font-weight: 800; margin-top: 2px;">${props.CVE_MZA || 'S/N'}</div>
                        </div>

                        <div style="padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-top: none; border-radius: 0 0 8px 8px;">
                            <div style="margin-bottom: 12px; text-align: center;">
                                <span style="font-size: 10px; color: #666; display: block; margin-bottom: 2px;">CLAVE ÚNICA (CVEGEO)</span>
                                <span style="background: #eef2f5; color: #333; padding: 4px 8px; border-radius: 4px; font-family: monospace; font-size: 13px; font-weight: bold; border: 1px solid #ccc; display: block; letter-spacing:1px;">
                                    ${props.CVEGEO || 'Sin Dato'}
                                </span>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px;">
                                <div><strong style="color: #7E1928;">MUNICIPIO</strong><br>${props.CVE_MUN || '-'}</div>
                                <div><strong style="color: #7E1928;">LOCALIDAD</strong><br>${props.CVE_LOC || '-'}</div>
                                <div><strong style="color: #7E1928;">AGEB</strong><br>${props.CVE_AGEB || '-'}</div>
                                <div><strong style="color: #7E1928;">ÁMBITO</strong><br>${props.AMBITO || '-'}</div>
                            </div>

                            <div style="margin-top: 12px; border-top: 1px dashed #ccc; padding-top: 8px; font-size: 10px; text-align: center; color: #888;">
                                TIPO: <strong style="color: #444;">${props.TIPOMZA || 'Estándar'}</strong>
                            </div>
                        </div>
                    </div>
                `;
                layer.bindPopup(fichaHTML, { maxWidth: 300, className: 'popup-manzana-custom' });
            }
        }); 
        
        // --- EVENTOS MAESTROS (MANZANAS) ---
        layer_Manzanas.on('click', function(e) {
            var layer = e.layer; 

            if (manzanaActiva && manzanaActiva !== layer) {
                layer_Manzanas.resetStyle(manzanaActiva);
            }
            
            layer.setStyle({
                weight: 3.1, 
                color: '#C3935D', 
                fillColor: '#FFD700', 
                fillOpacity: 0.6 
            });
            
            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            
            manzanaActiva = layer;
        });

        layer_Manzanas.on('popupclose', function(e) {
            var layer = e.layer;
            layer_Manzanas.resetStyle(layer);
            if (manzanaActiva === layer) {
                manzanaActiva = null;
            }
        });

        if (!L.Browser.mobile) {
            layer_Manzanas.on('mouseover', function(e) {
                var layer = e.layer;
                if (manzanaActiva !== layer) {
                    layer.setStyle({
                        weight: 3, 
                        color: '#C3935D', 
                        fillColor: '#FFD700', 
                        fillOpacity: 0.6 
                    });
                    layer.bringToFront();
                }
            });

            layer_Manzanas.on('mouseout', function(e) {
                var layer = e.layer;
                if (manzanaActiva !== layer && !layer.isPopupOpen()) {
                    layer_Manzanas.resetStyle(layer);
                }
            });
        }

        layer_Manzanas.addTo(map);

    } else {
        console.log("⚠️ ERROR: No encuentro json_Manzanas_4");
        layer_Manzanas = L.layerGroup();
    }

    // --- C. VIALIDADES (Red de Calles) ---    
    var vialidadActiva = null;
    var layer_Vialidades;

    if (typeof json_Vialidades_7 !== 'undefined') {
        layer_Vialidades = new L.geoJson(json_Vialidades_7, {
            
            renderer: dibujanteCompartido,
            smoothFactor: 3, 

            style: function(feature) {
                return {
                    pane: 'pane_Alumbradopostes_12', 
                    color: '#636e72',     
                    weight: 3,             
                    opacity: 0.8,
                    dashArray: '5, 7',     
                    interactive: true
                };
            },
            
            onEachFeature: function (feature, layer) {
                var props = feature.properties;
                
                var tipo = props.TIPOVIAL || ''; 
                var nombreRaw = props.NOMVIAL || '';
                if (nombreRaw.toLowerCase() === 'ninguno') { nombreRaw = 'SIN NOMBRE'; }
                var nombreCompleto = (tipo + ' ' + nombreRaw).trim();
                if (nombreCompleto === "" || nombreCompleto === "SIN NOMBRE") {
                    nombreCompleto = "VIALIDAD SIN NOMBRE";
                }

                var fichaCalle = `
                    <div style="font-family: 'Montserrat', sans-serif; min-width: 240px;">
                        <div style="background: #34495e; color: white; padding: 8px; border-radius: 6px 6px 0 0; border-bottom: 3px solid #C3935D; text-align: center;">
                            <div style="font-size: 8px; letter-spacing: 1px; opacity:0.8;">CLAVE DE VIALIDAD</div>
                            <div style="font-size: 14px; font-weight: 800; letter-spacing: 2px;">
                                ${props.CVEVIAL || 'S/N'}
                            </div>
                        </div>
                        <div style="padding: 15px; background: white; border: 1px solid #ccc; border-top: none; border-radius: 0 0 6px 6px;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                <div style="font-size: 10px; color: #7f8c8d; font-weight: 600; margin-bottom: 4px; text-transform: uppercase;">NOMBRE PÚBLICO</div>
                                <div style="font-size: 15px; font-weight: 800; color: #2c3e50; text-transform: uppercase; line-height: 1.2;">
                                    ${nombreCompleto}
                                </div>
                            </div>
                            <div style="border-top: 1px dashed #eee; padding-top: 8px; font-size: 11px; color: #666; display: flex; align-items: center; justify-content: center;">
                                <span style="margin-right: 5px;">SENTIDO:</span> 
                                <strong style="color: #333;">${props.SENTIDO || 'No Definido'}</strong>
                            </div>
                        </div>
                    </div>
                `;
                layer.bindPopup(fichaCalle, { className: 'popup-calle-custom' });
            }
        });

        // --- EVENTOS MAESTROS (VIALIDADES) ---
        layer_Vialidades.on('click', function(e) {
            var layer = e.layer;
            
            layer.setStyle({ 
                color: '#2c3e50', 
                weight: 5, 
                dashArray: '', 
                opacity: 1 
            });
            
            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) { 
                layer.bringToFront(); 
            }
            
            map.fitBounds(layer.getBounds());
        });

        layer_Vialidades.on('popupclose', function(e) {
            layer_Vialidades.resetStyle(e.layer);
        });

        if (!L.Browser.mobile) {
            layer_Vialidades.on('mouseover', function(e) {
                var layer = e.layer;
                layer.setStyle({ 
                    color: '#2c3e50', 
                    weight: 5, 
                    dashArray: '', 
                    opacity: 1 
                });
                layer.bringToFront();
            });
            
            layer_Vialidades.on('mouseout', function(e) {
                if (!e.layer.isPopupOpen()) {
                    layer_Vialidades.resetStyle(e.layer);
                }
            });
        }

        layer_Vialidades.addTo(map);

    } else {
        console.log("⚠️ No encuentro json_Vialidades_7");
        layer_Vialidades = L.layerGroup();
    }

    // --- D. AGEBS (Zonificación de Barrios) ---
    var layer_AGEB;

    if (typeof json_AGEB_6 !== 'undefined') {
        layer_AGEB = new L.geoJson(json_AGEB_6, {
            
            renderer: dibujanteCompartido,
            
            style: function(feature) {
                return {
                    pane: 'pane_Alumbradopostes_12',
                    color: '#ff0000',       
                    weight: 3,
                    opacity: 0.8,
                    fill: false,            
                    interactive: true
                };
            },
            
            onEachFeature: function (feature, layer) {
                
                layer.on({
                    mouseover: function(e) {
                        var layer = e.target;
                        layer.setStyle({
                            weight: 4,
                            color: '#ffd700',
                            opacity: 1
                        });
                        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                            layer.bringToFront();
                        }
                    },
                    mouseout: function(e) {
                        layer_AGEB.resetStyle(e.target);
                    }
                });

                if (feature.properties['CVE_AGEB']) {
                    layer.bindTooltip(
                        `<div style="font-weight:900; font-size:10px; color:#6c5ce7; text-shadow: 1px 1px 0 #fff;">
                            ${feature.properties['CVE_AGEB']}
                        </div>`,
                        { permanent: true, direction: "center", className: "label-ageb" }
                    );
                }

                var props = feature.properties;
                
                var popupAGEB = `
                    <div style="text-align:center; font-family: 'Montserrat', sans-serif; min-width: 200px;">
                        
                        <div style="background: #6c5ce7; color: white; padding: 10px; border-radius: 6px 6px 0 0; text-transform: uppercase;">
                            <div style="font-size: 10px; letter-spacing: 1px; opacity: 0.9;">ZONA (AGEB)</div>
                            <div style="font-size: 22px; font-weight: 800; margin-top: 0px;">
                                ${props.CVE_AGEB || 'S/N'}
                            </div>
                        </div>

                        <div style="padding: 15px; background: white; border: 1px solid #ddd; border-top: none; border-radius: 0 0 6px 6px;">
                            <div style="margin-bottom: 5px;">
                                <span style="font-size: 9px; color: #888; font-weight: 700; display: block; margin-bottom: 3px;">CLAVE ÚNICA NACIONAL (CVEGEO)</span>
                                <span style="background: #f0f3f6; color: #2c3e50; padding: 5px 10px; border-radius: 4px; font-family: monospace; font-size: 14px; font-weight: bold; border: 1px solid #dcdcdc; display: block; letter-spacing: 0.5px;">
                                    ${props.CVEGEO || 'Sin Dato'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                layer.bindPopup(popupAGEB, { className: 'popup-ageb-custom' });
            }
        }); 
    } else {
        console.log("⚠️ No encuentro la variable json_AGEB_6");
        layer_AGEB = L.layerGroup();
    }

    var overlaysTree = [
        // GRUPO 1: CATASTRO
        {
            label: '<b>Catastro Municipal</b>',
            selectAllCheckbox: true,
            collapsed: false,
            children: [
                {label: "📍 Límite Municipal", layer: layer_Limites},
                {label: "🟣 Zonificación (AGEBs)", layer: layer_AGEB},
                {label: "⬜ Traza Urbana (Manzanas)", layer: layer_Manzanas},
                {label: "🛣️ Red Vial (Nombres)", layer: layer_Vialidades},
            ]
        },

        // GRUPO 3: INFRAESTRUCTURA (Lámparas)
        // GRUPO 3: INFRAESTRUCTURA (CON SUBGRUPOS)
        {
            label: '<b>Infraestructura Urbana</b>',
            selectAllCheckbox: true,
            children: [
                // SUBGRUPO A: LUMINARIAS
                {
                    label: '💡 Alumbrado Público',
                    selectAllCheckbox: true,
                    collapsed: true, // Que empiece cerrado para no ocupar mucho espacio
                    children: [
                        {label: '⚫ Apagada', layer: layer_Apagada_11},
                        {label: '🟢 Operativo (Bueno)', layer: layer_Bueno_10},
                        {label: '🔴 Dañado', layer: layer_Daado_9},
                        {label: '🟡 Directa', layer: layer_Directa_8},
                        {label: '🟣 Intermitente', layer: layer_Intermitente_7},
                        {label: '🟠 Otro', layer: layer_Otro_6},
                    ]
                },
                // SUBGRUPO B: BACHES (PAVIMENTO)
                {
                    label: '🚧 Estado del Pavimento (baches)',
                    selectAllCheckbox: true,
                    collapsed: false, // Este abierto para que se vea la novedad
                    children: [
                        {label: '🔺 Riesgo Alto', layer: layer_RiesgoAlto},
                        {label: '🔸 Riesgo Medio', layer: layer_RiesgoMedio},
                        {label: '⚠️ Riesgo Bajo', layer: layer_RiesgoBajo},
                    ]
                }
            ]
        },

        // GRUPO 4: ORTOFOTOS
        {
            label: '<b>Ortofotos</b>',
            selectAllCheckbox: true,
            collapsed: true,
            children: [
                {label: "Ortofoto Parte 1", layer: layer_dji_fly_20250722_185256_0182_1769184314666_photo_modified_5},
                {label: "Ortofoto Parte 2", layer: layer_dji_fly_20250722_185244_0181_1769184310403_photo_modified_4},
            ]
        },
        {
            label: '<b>Mapas Base</b>',
            selectAllCheckbox: false, 
            collapsed: true, 
            children: [
                {label: "🛰️ Google Híbrido", layer: layer_GoogleSatelliteHybrid_3, radioGroup: 'bm' },
                {label: "🌍 Google Satélite", layer: layer_GoogleMapSatellite_2, radioGroup: 'bm' },
                {label: "🗺️ Google Maps", layer: layer_GoogleMaps_1, radioGroup: 'bm' },
                {label: "🏙️ OpenStreetMap", layer: layer_OpenStreetMap_0, radioGroup: 'bm' },
            ]
        }
    ];

    // DIBUJAR EL CONTROL
    var isMobile = window.innerWidth < 768;
    var lay = L.control.layers.tree(null, overlaysTree, {
        namedToggle: false,
        selectorBack: false,
        collapsed: isMobile,
    });
    
    lay.addTo(map);
        
        //setBounds();
        var i = 0;
        layer_Otro_6.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Otro_6'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Intermitente_7.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Intermitente_7'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Directa_8.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Directa_8'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Daado_9.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Daado_9'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Bueno_10.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Bueno_10'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_Apagada_11.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Id'] !== null?String('<div style="color: #000000; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['Id']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Apagada_11'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        
        map.addControl(new L.Control.Search({
            layer: layer_Alumbradopostes_12,
            initial: false,
            hideMarkerOnCollapse: true,
            propertyName: 'Id'}));
        if (typeof url === 'undefined') {
            document.getElementsByClassName('search-button')[0].className += ' fa fa-binoculars';
        } else {
            document.getElementsByClassName('search-button')[1].className += ' fa fa-binoculars';
        }
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        
    map.on("layerremove", function(){
        resetLabels([layer_Otro_6,layer_Intermitente_7,layer_Directa_8,layer_Daado_9,layer_Bueno_10,layer_Apagada_11]);
    });

    map.on("layerremove", function(){
        resetLabels([layer_Otro_6,layer_Intermitente_7,layer_Directa_8,layer_Daado_9,layer_Bueno_10,layer_Apagada_11]);
    });
/*
    var sliderControl = null;
    var visualHandle = null; 
    var labelLeft = null;
    var labelRight = null;
    var ultimaCapaSatelite = null; 

    // CONFIGURACIÓN DE AÑOS
    var textoViejo = "Historico";
    var textoNuevo = "2025";

    // 1. Capa Histórica (Izquierda)
    map.createPane('pane_Historico');
    map.getPane('pane_Historico').style.zIndex = 405; 
    
    capaVieja = L.tileLayer('https://clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Esri Clarity (Histórico)',
        maxZoom: 22,
        maxNativeZoom: 17, 
        pane: 'pane_GoogleMapSatellite_2' 
    });

    // 2. Crear Botón
    L.Control.Comparador = L.Control.extend({
        onAdd: function(map) {
            var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control btn-google-earth');
            div.id = "btn-timeline"; 
            div.onclick = function(e) { 
                L.DomEvent.stopPropagation(e);
                toggleSlider(); 
            };
            div.innerHTML = '<i class="fas fa-history"></i>';
            return div;
        }
    });
    new L.Control.Comparador({ position: 'topleft' }).addTo(map);

    // 3. FUNCIÓN DE LIMPIEZA TOTAL 
    function matarTodo() {
        // Matar plugin
        if (sliderControl) {
            try { sliderControl.remove(); } catch(e){}
            sliderControl = null;
        }
        if (map.hasLayer(capaVieja)) map.removeLayer(capaVieja);

        // LIMPIEZA CSS 
        var elements = document.querySelectorAll('.leaflet-pane, .leaflet-layer, .leaflet-tile-container');
        elements.forEach(function(el){ el.style.clip = ''; });

        if (visualHandle) { visualHandle.remove(); visualHandle = null; }
        if (labelLeft) { labelLeft.remove(); labelLeft = null; }
        if (labelRight) { labelRight.remove(); labelRight = null; }

        var btn = document.getElementById('btn-timeline');
        if(btn) btn.classList.remove('active');
    }

    function toggleSlider() {
        var btn = document.getElementById('btn-timeline');

        if (sliderControl) {
          
            matarTodo();
        } else {
        
            var sateliteActual = getSateliteActivo();
            
            if (sateliteActual) {
                capaVieja.addTo(map);
                sliderControl = L.control.sideBySide(capaVieja, sateliteActual);
                sliderControl.addTo(map);
                
                crearAdornos();
                btn.classList.add('active');
            }
        }
    }

    function crearAdornos() {
        var l = document.createElement('div'); l.className = 'year-chip chip-left'; l.innerHTML = textoViejo;
        var r = document.createElement('div'); r.className = 'year-chip chip-right'; r.innerHTML = textoNuevo;
        document.body.appendChild(l); document.body.appendChild(r);
        labelLeft = l; labelRight = r;

        var handle = document.createElement('div');
        handle.className = 'sbs-handle-visual';
        handle.innerHTML = '<i class="fas fa-arrows-alt-h"></i>';
        
        setTimeout(function(){
            var divider = document.querySelector('.leaflet-sbs-divider');
            if(divider) divider.appendChild(handle);
            visualHandle = handle;
        }, 50);
    }

    // 5. HELPER:
    function getSateliteActivo() {
        if (map.hasLayer(layer_GoogleMapSatellite_2)) return layer_GoogleMapSatellite_2;
        if (map.hasLayer(layer_GoogleSatelliteHybrid_3)) return layer_GoogleSatelliteHybrid_3;
        return null;
    }

    // 6. EL VIGILANTE 
    map.on('baselayerchange', function(e) {
        matarTodo();
        
       
        verificarVisibilidadBoton();
    });

   
    function verificarVisibilidadBoton() {
        var btn = document.getElementById('btn-timeline');
        if (!btn) return;

     
        var satelite = getSateliteActivo();

        if (satelite) {
            btn.style.display = 'flex'; 
        } else {
            btn.style.display = 'none';
            if(sliderControl) matarTodo();
        }
    }

    setTimeout(verificarVisibilidadBoton, 500);*/
        
        </script>    
        
        <div id="image-modal" class="modal-overlay" onclick="closeModal()">
  <span class="close-modal">&times;</span>
  <img class="modal-content" id="full-image">
</div>
    
    <script>
        function closeModal() {
            document.getElementById("image-modal").style.display = "none";
        }

        document.addEventListener('click', function(e) {
            
            if (e.target && e.target.tagName === 'IMG' && e.target.closest('.leaflet-popup-content')) {
                
                e.preventDefault();
                e.stopPropagation();

                var modal = document.getElementById("image-modal");
                var modalImg = document.getElementById("full-image");
                
                modal.style.display = "flex";
                modal.style.alignItems = "center";
                modal.style.justifyContent = "center";
                
                modalImg.src = e.target.src;
            }
        });
    </script>


    <div id="chart-modal" class="modal-overlay" onclick="closeChart()">
    <div class="chart-card-drobot" onclick="event.stopPropagation()">
        
        <div class="chart-header-drobot">
            <span class="chart-title" id="chartTitle">
                <i class="fas fa-chart-pie"></i> Estadísticas Generales
            </span>
            <span class="close-chart-btn" onclick="closeChart()">&times;</span>
        </div>

        <div class="chart-tabs">
            <button class="tab-btn active" onclick="switchTopic('luminarias', this)">
                <i class="fas fa-lightbulb"></i> Alumbrado
            </button>
            <button class="tab-btn" onclick="switchTopic('baches', this)">
                <i class="fas fa-car-crash"></i> Baches
            </button>
            <button class="tab-btn" onclick="switchTopic('general', this)">
                <i class="fas fa-city"></i> Resumen
            </button>
        </div>
        
        <div class="chart-body-drobot">
            <canvas id="drobotChart"></canvas>
        </div>
        
        <div class="chart-controls-drobot">
            <button class="chart-btn active" onclick="updateChartType('bar', this)"><i class="fas fa-chart-bar"></i></button>
            <button class="chart-btn" onclick="updateChartType('doughnut', this)"><i class="fas fa-circle-notch"></i></button>
            <button class="chart-btn" onclick="updateChartType('pie', this)"><i class="fas fa-chart-pie"></i></button>
            <button class="chart-btn" onclick="updateChartType('line', this)"><i class="fas fa-chart-line"></i></button>
        </div>
    </div>
</div>


    <style>
    /* --- ESTILOS DEL DASHBOARD DROBOT --- */
    .chart-card-drobot {
        background: white;
        border-radius: 16px; 
        width: 95%;
        max-width: 700px; 
        box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        overflow: hidden; 
        display: flex;
        flex-direction: column;
        animation: slideUp 0.4s ease;
    }

    .chart-header-drobot {
        background: linear-gradient(90deg, #0b1c2c 0%, #1a2e40 100%); 
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .chart-title { font-weight: 700; font-size: 18px; letter-spacing: 0.5px; }
    .close-chart-btn { font-size: 28px; cursor: pointer; color: rgba(255,255,255,0.8); transition: 0.2s; }
    .close-chart-btn:hover { color: white; }

    .chart-body-drobot {
        padding: 25px;
        height: 350px; 
        position: relative;
    }

    .chart-controls-drobot {
        padding: 15px 25px;
        background: #f8f9fa; 
        border-top: 1px solid #eee;
        display: flex;
        justify-content: center;
        gap: 10px;
    }
    .chart-btn {
        background: white;
        border: 1px solid #ddd;
        padding: 10px 20px;
        border-radius: 30px; 
        cursor: pointer;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        color: #555;
        transition: all 0.3s ease;
        display: flex; align-items: center; gap: 8px;
    }
    .chart-btn i { font-size: 16px; }
    
    /* Estado Activo y Hover */
    .chart-btn:hover { background: #f0f0f0; transform: translateY(-2px); }
    .chart-btn.active {
        background: #0b1c2c; 
        color: white;
        border-color: #0b1c2c;
        box-shadow: 0 4px 10px rgba(11, 28, 44, 0.3);
    }
    @keyframes slideUp { from {transform:translateY(50px); opacity:0} to {transform:translateY(0); opacity:1} }

    /* --- ESTILO DE LA CAJA BLANCA DEL LOGO --- */
        .logo-box {
    background-color: white;
    padding: 5px 12px;
    border-radius: 6px;
    margin-right: 15px;
    height: 60px; 
    display: flex;
    align-items: center; 
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

        #drobot-logo { 
            height: 90%;   
            width: auto;
            margin-right: 0; 
            display: block; 
            filter: none;    
        }
</style>

<script>
    // --- LÓGICA DASHBOARD MULTI-TEMA V2 ---

    // 1. Botón Flotante en el Mapa
    L.Control.Graph = L.Control.extend({
        onAdd: function(map) {
            var div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            div.innerHTML = '<a href="#" title="Estadísticas" role="button" onclick="openChart(event)" style="display:flex; align-items:center; justify-content:center; width:34px; height:34px;"><i class="fas fa-chart-pie" style="font-size:18px; color:#555;"></i></a>';
            return div;
        }
    });
    new L.Control.Graph({ position: 'topleft' }).addTo(map);

    // 2. Variables Globales
    var myChart;
    var currentTopic = 'luminarias'; // Tema por defecto

    // DATOS (Se calculan al abrir)
    var dataLuminarias = {};
    var dataBaches = {};
    var dataGeneral = {};

    function calcularDatos() {
        // A. LUMINARIAS (Se queda igual)
        dataLuminarias = {
            labels: ['Apagada', 'Operativo', 'Dañado', 'Directa', 'Intermitente', 'Otro'],
            data: [
                (typeof json_Apagada_11 !== 'undefined' ? json_Apagada_11.features.length : 0),     // [0]
                (typeof json_Bueno_10 !== 'undefined' ? json_Bueno_10.features.length : 0),       // [1] <-- ESTAS SON LAS BUENAS
                (typeof json_Daado_9 !== 'undefined' ? json_Daado_9.features.length : 0),         // [2]
                (typeof json_Directa_8 !== 'undefined' ? json_Directa_8.features.length : 0),     // [3]
                (typeof json_Intermitente_7 !== 'undefined' ? json_Intermitente_7.features.length : 0), // [4]
                (typeof json_Otro_6 !== 'undefined' ? json_Otro_6.features.length : 0)            // [5]
            ],
            colors: ['#34495e', '#2ecc71', '#e74c3c', '#f1c40f', '#9b59b6', '#e67e22']
        };

        // B. BACHES (Se queda igual)
        dataBaches = {
            labels: ['Riesgo Alto', 'Riesgo Medio', 'Riesgo Bajo'],
            data: [
                (typeof json_RiesgoAlto_15 !== 'undefined' ? json_RiesgoAlto_15.features.length : 0),
                (typeof json_RiesgoMedio_14 !== 'undefined' ? json_RiesgoMedio_14.features.length : 0),
                (typeof json_RiesgoBajo_13 !== 'undefined' ? json_RiesgoBajo_13.features.length : 0)
            ],
            colors: ['#c0392b', '#d35400', '#f39c12']
        };

        // --- C. GENERAL (CORREGIDO: SOLO PROBLEMAS) ---
        
        // 1. Calcular fallas de luz (Total menos las "Operativo")
        var totalLuces = dataLuminarias.data.reduce((a, b) => a + b, 0);
        var lucesBuenas = dataLuminarias.data[1]; // El índice 1 es 'Operativo'
        var fallasAlumbrado = totalLuces - lucesBuenas; // Solo contamos las malas

        // 2. Calcular total de baches
        var totalBaches = dataBaches.data.reduce((a, b) => a + b, 0);
        
        dataGeneral = {
            labels: ['Fallas de Alumbrado', 'Baches Registrados'], // Etiquetas claras
            data: [fallasAlumbrado, totalBaches],
            // Usamos colores de "Alerta" (Rojo vs Naranja)
            colors: ['#c0392b', '#e67e22'] 
        };
    }

    // 3. Abrir Dashboard
    function openChart(e) {
        if(e) e.preventDefault();
        calcularDatos(); // Recalcular siempre por si cambiaron filtros
        document.getElementById("chart-modal").style.display = "flex";
        
        // Iniciar en la pestaña por defecto
        switchTopic('luminarias', document.querySelector('.tab-btn')); 
    }

    function closeChart() {
        document.getElementById("chart-modal").style.display = "none";
    }

    // 4. CAMBIAR TEMA (PESTAÑAS)
    function switchTopic(topic, btn) {
        currentTopic = topic;
        
        // Actualizar botones visualmente
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        else document.querySelectorAll('.tab-btn')[0].classList.add('active');

        // Seleccionar datos según el tema
        var dataset, titulo;
        if (topic === 'luminarias') {
            dataset = dataLuminarias;
            titulo = "Estado del Alumbrado";
        } else if (topic === 'baches') {
            dataset = dataBaches;
            titulo = "Reporte de Baches";
        } else {
            dataset = dataGeneral;
            titulo = "Diagnóstico de Problemas";
        }

        // Actualizar título
        document.getElementById('chartTitle').innerHTML = `<i class="fas fa-chart-pie"></i> ${titulo}`;

        // Renderizar gráfica
        renderChart(dataset);
    }

    // 5. RENDERIZAR GRÁFICA
    // 5. RENDERIZAR GRÁFICA (CORREGIDA)
    function renderChart(dataset, type = 'bar') {
        var ctx = document.getElementById('drobotChart').getContext('2d');
        
        if (myChart) myChart.destroy(); 

        myChart = new Chart(ctx, {
            type: type,
            data: {
                labels: dataset.labels,
                datasets: [{
                    label: 'Cantidad',
                    data: dataset.data,
                    backgroundColor: dataset.colors, // Colorea las barras y los puntos
                    
                    /* --- CORRECCIÓN AQUÍ --- */
                    // Si es 'line', la línea es Gris Oscuro (#555). Si es barra/pastel, el borde es Blanco.
                    borderColor: type === 'line' ? '#555555' : '#ffffff',
                    
                    borderWidth: 2,
                    fill: false, // Evita que la línea rellene el fondo de color
                    tension: 0.3 // Suaviza un poco las curvas de la línea
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: type !== 'bar', position: 'bottom' },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        padding: 10
                    }
                },
                scales: {
                    x: { display: type === 'bar' || type === 'line' },
                    y: { display: type === 'bar' || type === 'line', beginAtZero: true }
                }
            }
        });
    }

    // 6. CAMBIAR TIPO DE GRÁFICA (Botones de abajo)
    function updateChartType(newType, btn) {
        // Actualizar estilo botones
        document.querySelectorAll('.chart-controls-drobot .chart-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Recuperar datos actuales y redibujar
        var dataset;
        if (currentTopic === 'luminarias') dataset = dataLuminarias;
        else if (currentTopic === 'baches') dataset = dataBaches;
        else dataset = dataGeneral;

        renderChart(dataset, newType);
    }

    // --- LÓGICA DEL PANEL MÓVIL ---
    
    map.on('popupopen', function(e) {
        if (window.innerWidth < 768) {
            
            var contenido = e.popup.getContent();
            
            var panel = document.getElementById('panel-movil');
            var contenedor = document.getElementById('contenido-panel');
            
            contenedor.innerHTML = contenido;
            
            panel.classList.add('panel-movil-activo');
        }
    });

    function cerrarPanelMovil() {
        document.getElementById('panel-movil').classList.remove('panel-movil-activo');
        
        map.closePopup();
    }

    map.on('click', function() {
        if (window.innerWidth < 768) {
            cerrarPanelMovil();
        }
    });

</script>

    <div id="panel-movil" class="panel-movil-oculto">
    <button id="btn-cerrar-panel" onclick="cerrarPanelMovil()">×</button>
    <div id="contenido-panel">
        </div>
</div>

    </body>
</html>